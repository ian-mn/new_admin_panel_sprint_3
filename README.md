# –ü—Ä–æ–µ–∫—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ: ETL
![Black](https://img.shields.io/badge/code%20style-black-black)
![Tests](https://github.com/ian-mn/new_admin_panel_sprint_3/actions/workflows/tests.yml/badge.svg?branch=main)
[![Maintainability](https://api.codeclimate.com/v1/badges/2a3910f5a464aba50670/maintainability)](https://codeclimate.com/github/ian-mn/new_admin_panel_sprint_3/maintainability)
## –ó–∞–¥–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞

–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –∏–∑ Postgres –≤ Elasticsearch

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—É—é [c—Ö–µ–º—É –∏–Ω–¥–µ–∫—Å–∞](https://code.s3.yandex.net/middle-python/learning-materials/es_schema.txt)üíæ  `movies`, –≤ –∫–æ—Ç–æ—Ä—É—é –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤. –í –∫–æ–Ω—Ü–µ —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –≤—ã –Ω–∞–π–¥—ë—Ç–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è –∫ –Ω–µ–π.
- –í–∞—à –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ —Å ES –∏–ª–∏ Postgres. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É backoff, —á—Ç–æ–±—ã –≤–∞—à —Å–µ—Ä–≤–∏—Å –Ω–µ –º–µ—à–∞–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ë–î.
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, –∞ –Ω–µ –Ω–∞—á–∏–Ω–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–æ–≤–æ. –ó–¥–µ—Å—å –≤–∞–º –ø–æ–º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
- ES —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç [Postman-—Ç–µ—Å—Ç—ã](https://code.s3.yandex.net/middle-python/learning-materials/ETLTests-2.json)üíæ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º —Å–ø–æ—Å–æ–±–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º –≤ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ.

## –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –∏–∑ SQLite –≤ PostgreSQL;
- Extract, Transform –∏ Load –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–∞—á–∫–∞–º–∏;
- –ó–∞–ø–∏—Å–∏ –∏–∑ –ë–î –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é pydantic;
- Extract –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏;
- ETL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∑–∞–∫—É—Å–∫–µ docker-compose, –¥–∞–ª–µ–µ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É –≤—ã—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ APScheduler;
- –ó–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –æ—Ç–≤–µ—á–∞–µ—Ç State;
- –¢–∞–º –∂–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏, —á—Ç–æ–±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ETL –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–ª–∏—Å—å –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞;
- State –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–∏–±–æ Redis, –ª–∏–±–æ JSON-—Ñ–∞–π–ª;
- –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å PostgreSQL, Redis –∏–ª–∏ ElasticSearch –ø—Ä–æ—Ü–µ—Å—Å –∂–¥–µ—Ç, –ø–æ–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å –ø–æ–º–æ—â—å—é exponential backoff;
- –¢–µ—Å—Ç—ã Postman –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `docker-compose.tests.yml`, –≥–¥–µ –∏—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç Newman;
- –¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Github Actions.

## –ó–∞–ø—É—Å–∫
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É `cd etl`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª `.env` –ø–æ –ø—Ä–∏–º–µ—Ä—É `.env.sample`
`use_redis_storage=True` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Redis, –∏–Ω–∞—á–µ - JSON-—Ñ–∞–π–ª
`automatic_updates=True` - –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å ETL –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É, –∏–Ω–∞—á–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å False, –∏–Ω–∞—á–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ETL –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è)
3. `docker-compose build`
4. `docker-compose up`
5. –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose -f docker-compose.tests.yml build && docker-compose -f docker-compose.tests.yml up`
